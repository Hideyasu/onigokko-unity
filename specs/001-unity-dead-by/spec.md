# 機能仕様書: リアル鬼ごっこゲーム「鬼 vs 陰陽師」

**機能ブランチ**: `001-project-setup`
**作成日**: 2025-09-13
**ステータス**: ドラフト
**入力**: ユーザー説明: "unity で作るスマホを使ったリアル Dead by daylight 風の鬼ごっこゲーム"

## 実行フロー (main)

```
1. ゲームコンセプトを解析
   → Dead by Daylight風リアル鬼ごっこの要件を抽出
   → 鬼（キラー）vs 陰陽師（サバイバー）の役割を定義
2. コア機能を特定
   → 心音判定システム（距離ベースの警告音）
   → リアルタイム位置追跡
   → トラップと攻撃メカニクス
3. 勝利条件を定義
   → 鬼側: 全陰陽師の魂を吸収
   → 陰陽師側: 儀式を完成させて鬼を封印する
4. 技術的要件を検証
   → Unity + Firebase構成の妥当性確認
   → GPS/Bluetooth機能の実装可能性
   → バックグラウンド動作の制約確認
5. ハッカソン制約を考慮
   → 24時間での実装可能範囲を評価
   → MVP（最小限の実装）を定義
   → コア機能（心音判定）を最優先
6. リスク要因を特定
   → iOS/Androidの権限制約
   → バッテリー消費問題
   → ネットワーク接続の安定性
7. 実装優先順位を決定
   → Phase 1: 心音判定とリアルタイム位置共有
   → Phase 2: 攻撃とトラップシステム
   → Phase 3: 儀式と勝利条件
8. Return: SUCCESS (仕様書完成・開発準備完了)
```

---

## ⚡ クイックガイドライン

### 本ゲームの核心要素

- 🎯 **コアコンセプト**: Dead by Daylight の緊張感を現実世界で再現
- 👹 **鬼 vs 陰陽師**: 非対称な対戦（1 対多）のバランス設計
- 📍 **リアル位置情報**: GPS を活用した現実世界でのプレイ
- 💓 **心音システム**: 距離に応じた段階的な警告音がゲームの緊張感を演出

### 開発上の重要方針

- ✅ **ハッカソン対応**: 24 時間で実装可能な機能範囲に限定
- ✅ **MVP 優先**: 心音判定機能を最優先で実装
- ✅ **段階的実装**: Phase 1（基本）→ Phase 2（戦闘）→ Phase 3（儀式）
- ⚠️ **技術制約**: iOS/Android のバックグラウンド制限を考慮
- 🔋 **バッテリー最適化**: 長時間プレイを想定した省電力設計

### ゲームバランスの考慮点

- **鬼側の優位性**: 1 人で複数を追う難しさを能力でカバー
- **陰陽師側の連携**: チームワークと戦略的なトラップ配置が鍵
- **時間制限**: 適切なゲーム時間（30-60 分程度）の設定
- **プレイエリア**: 安全性を考慮した範囲設定（半径 500m 程度）

---

## ゲームコンセプト

Dead by Daylight（DBD）をベースにした現実世界での「鬼ごっこ」ゲーム。プレイヤーは「鬼」側（キラー役）と「陰陽師」側（サバイバー役）の 2 陣営に分かれて対戦します。実際の町中で広範囲にわたってプレイする、位置情報を活用したモバイルゲームです。

## ユーザーシナリオ＆テスト _(必須)_

### 主要ユーザーストーリー

プレイヤーは実際の町中で、スマートフォンを使用してリアル鬼ごっこゲームに参加します。鬼役のプレイヤーは陰陽師を捕まえて魂を吸収し、全滅させることを目指します。陰陽師役のプレイヤーは鬼から逃げながら儀式を完成させて勝利を目指します。

### 受け入れシナリオ

#### ゲーム開始フェーズ

1. **前提** ゲームロビーに 4 人のプレイヤーが参加している、**とき** ホストがゲームを開始する、**ならば** 1 人が鬼に、3 人が陰陽師に自動的に割り当てられ、全員に役割が通知される

#### 心音システム

2. **前提** ゲーム中で鬼と陰陽師の距離が 50m、**とき** 鬼が陰陽師に近づく、**ならば** 陰陽師側に低い心音（レベル 1）が聞こえ始める
3. **前提** 鬼と陰陽師の距離が 30m 以内、**とき** さらに接近する、**ならば** 心音が中程度（レベル 2）に変化し、テンポが速くなる
4. **前提** 鬼と陰陽師の距離が 10m 以内、**とき** 至近距離まで接近、**ならば** 激しい心音（レベル 3）となり、画面にも警告表示が出る

#### 戦闘システム

5. **前提** 鬼が陰陽師に直接タッチする。**とき** 鬼と陰陽師がスマホを突き合わせる。**ならば** 魂を吸う演出が発生し、陰陽師の魂が鬼に吸われて、吸われた陰陽師はゲームから除外される。
6. **前提** 陰陽師が除外された、**とき** **ならば** 陰陽師は倒された状態になり、観戦モードに移行する

#### トラップシステム

7. **前提** 陰陽師がトラップを設置済み、**とき** 鬼がトラップから半径 5m 以内に入る、**ならば** トラップが発動し、鬼の攻撃が封印を解除しない限り封印され続ける。
8. **前提** 鬼の攻撃が封印中、**とき** 鬼が陰陽師に接触する、**ならば** 攻撃ボタンが無効化され、「封印中」のメッセージが表示される

#### 追跡システム

9. **前提** 陰陽師が走行状態で 10 秒以上移動、**とき** 走行を停止する、**ならば** 30 秒間、移動経路に足跡が表示される
10. **前提** 足跡が表示されている、**とき** 鬼がその場所を通過する、**ならば** 鬼の画面に足跡と経過時間が表示される

#### 勝利条件

11. **前提** 3 つの儀式ポイントが存在、**とき** 陰陽師が全ての儀式を完了する、**ならば** 「陰陽師の勝利」が表示され、ゲームが終了する
12. **前提** 3 人の陰陽師がゲーム中、**とき** 鬼が全員を倒す、**ならば** 「鬼の勝利」が表示され、ゲームが終了する

### エッジケース

- プレイヤーがゲーム中にネットワーク接続を失った場合の再接続処理
- GPS 信号が弱い場所での位置情報の補正方法
- アプリがバックグラウンドに移行した場合の通知と状態保持
- バッテリー切れが近い場合の警告表示
- プレイエリアから大きく離れた場合のペナルティまたは警告

## 要件 _(必須)_

### 機能要件

#### ゲーム基本機能

- **FR-001**: システムは 1 人の鬼と複数の陰陽師でゲームセッションを構成しなければならない
- **FR-002**: システムはプレイヤーの現在位置をリアルタイムで追跡しなければならない
- **FR-003**: システムは全プレイヤー間で位置情報を共有し、マップ上に表示しなければならない

#### 心音判定機能

- **FR-004**: システムは鬼と陰陽師の距離を計算し、近接度に応じた心音を再生しなければならない
- **FR-005**: 心音は段階的に変化し（遠い・中間・近い・至近距離）、陰陽師にのみ聞こえなければならない

#### 戦闘・アクション機能

- **FR-006**: 鬼は陰陽師にタッチすることで魂を吸収する攻撃ができなければならない
- **FR-007**: 陰陽師はトラップを設置でき、鬼の攻撃を一定時間封印できなければならない
- **FR-008**: トラップは有効時間と発動範囲を持たなければならない

#### 追跡機能

- **FR-009**: 陰陽師が走った後、一定時間足跡が表示されなければならない
- **FR-010**: 鬼は足跡を見て陰陽師を追跡できなければならない

#### 勝利条件

- **FR-011**: 陰陽師が儀式を完成させた場合、陰陽師側の勝利としなければならない
- **FR-012**: 鬼が全ての陰陽師を倒した場合、鬼側の勝利としなければならない

#### システム要件

- **FR-013**: アプリはバックグラウンドでも位置情報を更新し続けなければならない
- **FR-014**: システムはリアルタイムでデータを同期しなければならない
- **FR-015**: システムは 24 時間のハッカソンで実装可能な範囲に機能を絞らなければならない

### 主要エンティティ _(データが関わる場合に含める)_

- **プレイヤー**: 役割（鬼/陰陽師）、位置情報、体力、状態（生存/倒された）を持つ
- **ゲームセッション**: 参加プレイヤー、ゲーム状態、経過時間、儀式進行度を管理
- **トラップ**: 設置位置、有効時間、発動範囲、設置者情報を持つ
- **儀式**: 完成に必要な条件、現在の進行状況、完成判定を管理
- **足跡**: 発生位置、方向、残存時間を記録

---

## 技術的考慮事項（参考）

### 開発環境

- Unity をメイン開発環境として採用
- リアルタイムデータ同期に Firebase を使用
- 距離測定に Bluetooth または NearBy API を検討

### 実装課題

- iOS のバックグラウンド動作制限への対応
- リアルタイム位置情報共有の最適化
- バッテリー消費の最小化
- ネットワーク遅延への対処

---

## レビュー＆受け入れチェックリスト

### コンテンツ品質

- [x] 実装詳細を最小限に抑えている
- [x] ユーザー価値とゲーム体験に焦点を当てている
- [x] ゲームルールが明確に定義されている
- [x] すべての必須セクション完了

### 要件の完全性

- [x] 主要機能が定義されている
- [x] 勝利条件が明確
- [x] エッジケースを考慮している
- [x] ハッカソンの時間制限を考慮している
- [x] コア機能（心音判定）を優先している

---

## 実行ステータス

_処理中に main()により更新_

- [x] ユーザー説明を解析
- [x] 主要概念を抽出（鬼、陰陽師、心音、トラップ、儀式）
- [x] ゲームルールを明確化
- [x] ユーザーシナリオを定義
- [x] 要件を生成
- [x] エンティティを特定
- [x] レビューチェックリスト合格

---

## アクションアイテム

開発チームは以下のタスクを実行する必要があります：

1. Unity での技術検証を行う（特にビーコン/Bluetooth 関連）
2. 画面設計を作成し、それを基に使用技術を最終決定する
3. Firebase でのデータ構造を設計する
4. NearBy API の利用可能性を調査する
5. コアとなる心音判定機能の実装方法を確定させる

---
